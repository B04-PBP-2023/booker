{% extends 'base.html' %}
{% load static %}

{% block content %}
<br><br>
<div class="mt-4 d-flex flex-column">
  <div class="container">
    <div class="d-flex justify-content-center h-100">
      <div class="searchbar field w-75 w-lg-50">
        <input id="search_input" class="search_input" type="text" name="" placeholder="Cari buku, penulis, genre...">
        <span id="search_button_frontpage" class="content rounded-circle"><button
            class="fas fa-search w-100"></button></span>
      </div>
    </div>
  </div>
  <div class="d-flex flex-row justify-content-center mt-3">
    <button onclick="getBookshelf(1)" id="dipinjam-btn" class="rounded-start-pill select">Dipinjam</button>
    <button onclick="getBookshelf(0)" id="dibeli-btn" class="rounded-end-pill ms-3 select">Dibeli</button>
  </div>
  <a id="back-to-top" href="#" class="btn btn-light btn-lg content back-to-top px-lg-4 py-lg-3 z-0" role="button"><i
      class="fas fa-chevron-up"></i></a>
  <div class="row justify-content-center p-2" id="bookshelf_cards"></div>
</div>

<style>
  button.select {
    width: 10rem;
  }
</style>

<script>
  $(document).ready(function () {
    $(window).scroll(function () {
      if ($(this).scrollTop() > 50) {
        $('#back-to-top').fadeIn();
      } else {
        $('#back-to-top').fadeOut();
      }
    });
    // scroll body to 0px on click
    $('#back-to-top').click(function () {
      $('body,html').animate({
        scrollTop: 0
      }, 100);
      return false;
    });
  });

  document.addEventListener("DOMContentLoaded", function (event) {
    // put your javascript code here
  });

  getBookshelf(1)
  async function getBookshelf(q) {
    books = await fetch("{% url 'bookshelf:get_bookshelf_items' %}" + `?borrow=${q}`).then((res) => res.json());
    await refreshCards(books, q);
  }

  async function refreshCards(books, q) {
    let htmlString = ""
    if (q === 1) {
      document.getElementById("dibeli-btn").style = "box-shadow: 2px 2px 5px #babecc, -5px -5px 10px #ffffff73;"
      document.getElementById("dipinjam-btn").style = "box-shadow: inset 2px 2px 5px #babecc,inset -5px -5px 10px #ffffff73;"
    } else if (q === 0) {
      document.getElementById("dibeli-btn").style = "box-shadow: inset 2px 2px 5px #babecc, inset -5px -5px 10px #ffffff73;"
      document.getElementById("dipinjam-btn").style = "box-shadow: 2px 2px 5px #babecc, -5px -5px 10px #ffffff73;"
    }
    books.forEach((book) => {
      htmlString += `<div id="book_card" class="content book_card col-md-5 mx-3 my-3 position-relative" style="padding: 1.1rem 1.5rem">
        <div class="card-body h-100 d-flex flex-column">
          <div>
            <h5 class="card-title">${book.fields.name}</h5>
            <h6 class="card-subtitle text-light-emphasis mt-3">Penulis: ${book.fields.author}</h6>
            <h6 class="card-subtitle text-light-emphasis mt-2">Tahun: ${book.fields.year}</h6>
            <h6 class="card-subtitle text-light-emphasis mt-2">Genre: ${book.fields.genre}</h6>
          </div>
          <div class="mt-auto">
            <div class="d-flex flex-row justify-content-between mb-3 px-2">
              <h5 class="d-inline card-subtitle">
                <span class="fa fa-dollar-sign me-1"></span>${book.fields.price}
              </h5>
              <h5 class="d-inline card-subtitle">
                <span class="fa fa-star checked"></span>
                ${book.fields.rating}
              </h5>
            </div>
            ${q === 1 ? `<button class="w-100 text-center">
              Kembalikan
            </button>` : ''}
            <button class="w-100 text-center mt-3">
              Review
            </button>
          </div>
        </div>
      </div>`
    })

    document.getElementById("bookshelf_cards").innerHTML = htmlString
  }


</script>
{% endblock content %}